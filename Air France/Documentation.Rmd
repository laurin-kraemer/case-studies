---
title: "Workbook"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Part 1: Motivation

### Problem Statement
- High Costs per click with SEM (Search Engine Marketing)
- Airline industry a Competitive market with Low margins

### State the Questions
- Where do we allocate our marketing budget most efficiently?
- How can we reduce Cost/Click, increase revenue and optimize performance? 
- Which search engine delivers the most ROI? (Manuel)
- what are the customer segments / search engine
  --> Specific pattern in buying behavior?

### Main Objectives
- Find out profitability of campaigns / search engines / keywords
- Compare different bid strategies
- Which platform offers the most visibility?
- Find out single-click conversion rate of branded / unbranded keywords?
- Minimize Cost/Click
- Maximize ROA
- Maximize Revenue
- Maximize Single-click conversion
- Maximize Profitability
- Maximize Conversion Rate

## What could be a positive outcome?

# Part 2: Method

## What key resources do we acquire?

Data:
- Description


Are all the imported variables important?
Useful variables in the dataset (Type: xls)

$campaigns
$impressions
$click-through
$Cost/Click
$Revenue 
$Single-click conversion
$Profitability
$Conversion Rate



R Libraries

```{r message=FALSE, warning=FALSE}
# Import Libraries
library(readxl)
library(tidyr)
library(plotly)
library(dplyr)
```


## What is our approach to solve the problem?

High level process of steps 

# Part 3: Mechanics

### Inspect & Import data
R tries to import the first sheet of the excel file which resolves in an error. This is why the argument read_excel function has to be used to specify the column.

```{r message=FALSE, warning=FALSE}

# Inspect sheets of excel-file
excel_sheets('Spreadsheet_Data.xls')
```

```{r message=FALSE}
# Import data
kayak <- read_excel("Spreadsheet_Data.xls", 
                                                     sheet = "Kayak")

doubleclick <- read_excel("Spreadsheet_Data.xls", 
                         sheet = "DoubleClick")

```

### Massaging

```{r message=FALSE}
#Convert to dataframe
doubleclick <- as.data.frame(doubleclick)

# Get a big picture understanding of the data
summary(doubleclick)
str(doubleclick)

```

```{r}

#Look for weird stuff
table(doubleclick$`Match Type`)

# The NAs have to be removed.
doubleclick_clean <- na.omit(doubleclick)

# Notice how the number of rows gets reduced 
print(nrow(doubleclick_clean))

# Look for Spelling mistakes
unique(doubleclick_clean $`Bid Strategy`)

# Replace Typos
doubleclick_clean$`Bid Strategy` <- gsub("Postiion 1-4 Bid Strategy","Position 1-4 Bid Strategy",doubleclick_clean$`Bid Strategy`)

doubleclick_clean$`Bid Strategy` <- gsub("Position 1 -2 Target","Position 1-2 Target",doubleclick_clean$`Bid Strategy`)

# Create data set for analysis
sem <- doubleclick_clean[,c('Campaign','Keyword','Keyword Group','Publisher Name', 'Bid Strategy','Engine Click Thru %','Match Type','Trans. Conv. %','Total Cost/ Trans.')]

```

## Descriptive

```{r}

# Find out publishers
table(sem$`Publisher Name`)

# Select observations with the highest total cost per transaction
sem_sub <- subset(sem,subset = `Total Cost/ Trans.` > 0)

# Visualize the costs per transactions for different Publisher
p <- plot_ly(sem_sub, y = ~`Total Cost/ Trans.`, color = I("black"), 
             alpha = 0.2, boxpoints = "suspectedoutliers")
p1 <- p %>% add_boxplot(x = ~`Publisher Name`)
p1

# Visualize the converted transactions for different bid strategies
convert_bid <- plot_ly(sem_sub, y = ~`Trans. Conv. %`, color = I("black"), 
             alpha = 0.2, boxpoints = "suspectedoutliers")
p2 <- p %>% add_boxplot(x = ~`Bid Strategy`)
p2

# Visualize the numerical variables in 3D-Space
plot_ly(sem, x = ~`Engine Click Thru %`, y = ~`Trans. Conv. %`, z =~`Total Cost/ Trans.`) %>%
  add_markers(color = ~`Trans. Conv. %`)

```


### Campaigns
```{r}
# Find out aggregated Costs per campaign
#costs_campaigns <- aggregate(doubleclick_clean$`Total Cost`, by=list(doubleclick_clean$Campaign), FUN=sum)

#trans_costs_bid_str <- aggregate(doubleclick_clean$`Total Cost/Trans.`, by=list(doubleclick_clean$`Bid Strategy`), FUN=mean)

# Find out aggregated revenue per campaign
#revenue_campaigns <- aggregate(doubleclick_clean$Amount, by=list(doubleclick_clean$Campaign), FUN=sum)

#roi_campaign <- (revenue_campaigns$x/costs_campaigns$x)

```


### Keywords

```{r}
ggplot(data=doubleclick_clean, aes(x=doubleclick_clean$`Clicks`, y=doubleclick_clean$`Impressions`, color=doubleclick_clean$`Match Type`)) + geom_point()

```


```{r}


# Which publisher gets used the most
plot_ly(x = doubleclick_clean$'Publisher Name', type = "histogram")


# Find out aggregated Costs per publisher
costs_publisher <- aggregate(doubleclick_clean$`Total Cost`, by=list(doubleclick_clean$`Publisher Name`), FUN=sum)

# Find out aggregated Costs per matchtype
costs_matchtype <- aggregate(doubleclick_clean$`Total Cost`, by=list(doubleclick_clean$`Match Type`), FUN=sum)

# Calculate costs per booking
doubleclick_clean$'Costs per Booking' <- doubleclick_clean$`Total Cost`/doubleclick_clean$`Total Volume of Bookings`

```

### Visibility

```{r}
# Visualize impressions per publisher
plot_ly(doubleclick_clean, x = doubleclick_clean$`Publisher Name`, y=~Impressions)

# Visualize impressions per campaign
plot_ly(doubleclick_clean, x = doubleclick_clean$`Campaign`, y=~Impressions, type='bar')
```

### Volume of Bookings

```{r}
bookings_campaigns <- aggregate(doubleclick_clean$`Total Volume of Bookings`, by=list(doubleclick_clean$Campaign), FUN=sum)


plot_ly(bookings_campaigns, x=~Group.1, y=~x)
```
Most of the impressions got generated by unassigned keywords!




Statistics
Correlation
Association

## Predictive

Feature Selection
Apply ML-Algorithmus

# Mechanics

Distribution

Stats

Boxplot

Outlier

# Message

Key Findings

The C-suite of ___ face the following (problem/challenge), which is best solved with _ (solution) having an impact and/or making profits via ___ . The unique advantages/differentiators of the MVP are ____ , when comparing with the following key competitors / alternatives: ___

Next steps(What needs to be done!)

- Do branded keywords bring in more revenue?
- Are broad or focused keywords more profitable?
- Can assist keywords help increase conversion rate?

