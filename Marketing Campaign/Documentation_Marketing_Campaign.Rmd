---
title: "Marketing-Campaign - Case Study"
author: "Timon-Laurin Kr√§mer"
date: "11/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Problem Statement

---- INSERT -----------

### Main Objectives

---- INSERT ----------

### Key Ressources

----- INSERT --------

### High-Level Process

----- INSERT ----------

## Part 1

#### Importing

```{r, warning=FALSE,message=FALSE,echo=FALSE}
# Import libraries
library(readxl)
library(BBmisc)
library('fastDummies')

# Import data
mark_cmp <- read_excel("datasets_marketing_campaign_SF.xlsx")

# Inspect
colSums(is.na(mark_cmp))

# Convert
mark_cmp <- as.data.frame(mark_cmp)

```
#### Massaging

```{r}
library(tidyr)

# Remove NAs
mark_cmp <- drop_na(mark_cmp)

# Change date variable from character to date
mark_cmp$Dt_Customer <- as.Date(mark_cmp$Dt_Customer)

# Create sub dfs for types numerical, character and dates

bool <- sapply(mark_cmp,is.numeric)
num_cols <- mark_cmp[,bool]

bool <- sapply(mark_cmp,is.Date)
date_cols <- mark_cmp[,bool]

bool <- sapply(mark_cmp,is.character)
cat_cols <- mark_cmp[,bool]

# Create dummy variables for the categories
cat_dummy <- dummy_cols(cat_cols, select_columns = c('Education', 'Marital_Status','Country'))

# Remove the character entries
cat_dummy <- cat_dummy[,4:ncol(cat_dummy)]

# Write csv
write.csv(mark_cmp,"C:/Users/LK/Nextcloud7/Personal/Docs/case-studies/Marketing Campaign/data.csv", row.names = FALSE)


```


## Part 1a - Regression - Predictive 

Label: Web Purchases
Features: All numerical

### Motivation
Use of linear regression to classify the important variables that help us predict web purchases.

### Method
- Checklist for Regression
- Split into training and test data
- Scale data
- Train model using train data
- Use the fitted model to predict unseen values (test-data)
- Plot predicted vs actual values

### Mechanics

```{r}

# Scale the data
scaled_mark = normalize(mark_cmp, method = "range", range = c(0, 1))

# Split into training and test
train_index <- sample(1:nrow(mark_cmp),size=0.8*nrow(mark_cmp))
mark_train <- mark_cmp[train_index,]
mark_test <- mark_cmp[-train_index,]

# Train the model
model <- lm(NumWebPurchases ~ ., data=mark_train)
summary(model)

# Get residuals
res <- resid(model)

# Produce residual vs. fitted plot
plot(fitted(model), res)
qqnorm(res)

```

```{r,warning=FALSE,message=FALSE,echo=FALSE}

# Let the model predict values for the test data
pred <- predict(model,mark_test)

# Visualize the models performance
plot(pred,mark_test$NumWebPurchases)

```
### Message

We concluded that a few variables are not statistically significant. Therefore, we trained the model again using only the relevant variables.

### Better Regression

```{r}
# Train the model
better_model <- lm(NumWebPurchases ~ Income + Kidhome + Teenhome + MntWines + MntSweetProducts + MntGoldProds + NumDealsPurchases +NumStorePurchases +NumWebVisitsMonth, data=mark_train)
summary(model)

```
## Part 1b - Descriptive - US vs rest of world

### Motivation

- Do US-Customers buy more than the rest of the world?

### Method

- Aggregate columns rowwise to get the number of total purchases
- Split into US and Rest of the world

## Mechanics

```{r}

# Aggregate total purchases
mark_cmp$Total_Purch <- mark_cmp$NumDealsPurchases + mark_cmp$NumWebPurchases + mark_cmp$NumCatalogPurchases + mark_cmp$NumStorePurchases

table(mark_cmp$Country)


```
